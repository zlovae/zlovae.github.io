---
layout: post
title:  "Java并发编程的挑战"
date:   2019-04-30 16:37:28
categories: Java
tags: Java 并发
excerpt: 《Java并发编程的艺术》第一章
mathjax: true
---

并发编程是为了提高程序运行速度，更好的利用CPU的计算能力。并发编程----即内存中有更多的线程时----会存在一系列需要权衡和解决的问题，例如上下文切换问题、死锁问题、受限于软硬件资源的问题。

## 1.1 上下文切换

### 1.1.1 多线程一定快吗

### 1.1.2 测试上下文切换次数和时长

### 1.1.3 如何减少上下文切换
减少上下文切换的方法有无锁并发编程、CAS算法、使用最小线程和使用协程。

* **无锁并发编程**。多线程竞争锁时，会引起上下文切换，所以多线程处理数据时，可以使用一些办法来避免使用锁，如将数据的ID按照Hash算法取模分段，不同线程处理不同段的数据。
* **CAS算法**。Java的Atomic包使用CAS算法来更新数据，而不需要加锁。
* **使用最少线程**。避免创建不需要的线程，比如任务很少，但是创建了很多线程来处理，那会造成大量的线程处于等待状态。
* **协程**。在单线程里实现多任务的调度，并在单线程里维持多个任务间的切换。

### 1.1.4 减少上下文切换实战

## 1.2 死锁

## 1.3 资源限制的挑战

(1) 什么是资源限制

就像网速很慢时开很多线程下载东西，CPU不停切换线程，工作的时间反而少了。

(2) 资源限制引发的问题

在上下文切换和资源调度上浪费过多时间和算力。

(3) 如何解决资源限制的问题

集群或多机

(4) 在资源限制情况下进行并发编程

根据不同的资源限制调整程序的并发度。参考百度网盘的智能并发下载。

## 1.4 本章小结
本章介绍了并发编程中可能遇到的几个挑战，并且给出了一些建议。如果并发程序写得不严谨，出现问题会不好定位、很棘手。
同时作者建议使用JDK并发包提供的并发容器和工具类。即**不要重复造轮子**。


## 个人总结
这些问题都是操作系统中学过的，所以要做的就是**好好学习JDK并发包提供的并发容器和工具类，会熟练使用，熟悉源码**。

多线程就好像在饭店里每桌客人都点了很多菜，那么每个线程每次给每一桌上一盘菜，客人们就可以边吃边等，都不闲着。
但是如果是外送的单子，送一次的时间比炒一盘菜还要长，那肯定就不能一盘一盘送，这就是上下文切换问题。
如果客人过于多，第一桌的第一盘都吃完了最后一桌还没上，这种情况也不适合用多线程，因为这样所有的任务都在等待。