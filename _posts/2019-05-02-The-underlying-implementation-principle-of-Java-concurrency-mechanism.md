---
layout: post
title:  "Java并发机制的底层实现原理"
date:   2019-05-02 21:18:13
categories: Java
tags: Java 并发
excerpt: 《Java并发编程的艺术》第二章
mathjax: true
---

## 2.1 volatile的应用
#### 1.volatile的定义和实现原理
**定义**：`Java编程语言允许线程访问共享变量，为了确保共享变量能被准确和一致地更新，线程应该确保通过排他锁单独获得这个变量。`

###### CPU的术语定义：

* 内存屏障`memory barriers`： 是一组处理器指令，用于实现对内存操作的顺序限制
* 缓冲行`cache line`： 缓存中可以分配的最小存储单位。处理器填写缓存线时会加载整个缓存线，需要使用多个主内存读周期。
* 原子操作`atomic operations`： 不可中断的一个或一系列操作。
* 缓存行填充`cache line fill`： 当处理器识别到从内存中读取操作数是可缓存的，处理器读取整个缓存行到适当的缓存（L1，L2，L3的
或所有）。
* 缓存命中`cache hit`： 如果进行高速缓存行填充操作的内存位置仍然是下次处理器访问的地址时，处理器从缓存中读取操作数，而不是
从内存中读取。
* 写命中`write hit`： 当处理器将操作数写回到一个内存缓存的区域时，它会检查这个缓存的内存地址是否在缓存行中，如果存在一个有
效的缓存行，则处理器将这个操作数写回到缓存，而不是写回到内存，这个操作被称为写命中。
* 写缺失`write misses the cache`： 一个有效的缓存行被写入到不存在的内存区域。

**volatile两条实现原则**
Lock前缀指令会引起处理器缓存写回到内存。

一个处理器的缓存写回到内存会导致其他处理器的缓存无效。 
 

#### 2.volatile的使用优化
~~追加字节~~ Java7以后不是很需要。

## 2.2 synchronized的实现原理与应用
### 2.2.1 Java对象头

### 2.2.2 锁的升级和对比

锁 | 优点 | 缺点 | 适用场景
-|-|-|-
偏向锁| | | |




## 2.3 原子操作的实现原理

## 2.4 本章小结

## 个人总结


